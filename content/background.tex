%!TEX root = ../latex/paper.tex

\section{Background}
\label{sec:background}

\subsection{Stronger Typing for Dynamically Typed Languages}

\begin{cnote}
- the dynamic typing discussion as in the outline
\end{cnote}

\subsection{The Grace Programming Language}



\subsection{Moth: Grace on Graal and Truffle}
\label{ssec:moth}

Implementing dynamic languages as state-of-the-art virtual machines
can require enormous engineering efforts.
Meta-compilation approaches\citep{Marr:2015:MTPE}
such as RPython\citep{Bolz:2009:TMP,Bolz:2013:IMT}
and GraalVM\citep{Wurthinger2013,Wurthinger:2017:PPE}
reduce the necessary work dramatically,
because they allow language implementers to leverage existing VMs
and their support for just-in-time compilation and garbage collection.

To leverage this infrastructure, we developed an interpreter for Grace,
called Moth\citep{Roberts2017}, by adapting
\citeurl{\SOMns.}{SOMns: A Newspeak for Concurrency Research}{Stefan Marr}{}{https://github.com/smarr/SOMns/}
\SOMns is a Newspeak implementation\citep{Bracha:10:NS} on top of the Truffle framework and the Graal just-in-time compiler,
which are part of the GraalVM project.
Since Newspeak and Grace are related languages,
\SOMns provides a good foundation for a new Grace implementation.
It allowed us to reach the performance of V8,
Google's JavaScript implementation
(cf. \cref{sec:baseline-perf} and \citet{Marr2016}).
\SOMns was changed to parse Grace code.
\SOMns' self-optimizing abstract-syntax-tree nodes were only slightly adapted to conform to Grace's semantics.
As a result, Moth is \ugh{mostly compliant}\sm{do we need to make this more concrete, James?} to the specification.
One exception is that it still supports the \code{nil} value of Newspeak.


\sm{we could say many more things here, not sure we need to though, depends a bit on what we need/rely on in late text}

% While not everyone has time to create their own fully-fledged virtual, recent efforts such as PyPy \rrnote{CITE Tratt} or Truffle and Graal \cite{Wurthinger2013} are brining the power of VMs to researchers and hobbyists.

% As shown by Marr et al. \cite{Marr2016}, the peak performance of benchmarks is comparable to monolithic VM's like V8 and Crystal.

\subsection{Gradual Typing}

\sm{not sure this belongs here. it depends on how the paper is framed,
but my impression was that we don't want to say it is gradual, so,
this belongs perhaps better into the related work section for discussion
after the results}

Coined by Siek and Taha \cite{Siek2006}, later added the gradual ``guarantee'' \cite{Siek2015}.

\paragraph{Languages}

\sm{not sure what is supposed to be discussed here.
Seems to detailed, seems to to be long into the beginning of the paper}

\begin{itemize}
    \item Grace \cite{Boyland2014}
    \item Typed Racket \cite{Takikawa2016}
    \item Dart \cite{Heinze2016, Mezzetti2016}
    \item Pycket (using some kind of PyPy-like design) \cite{Bauman2017}
    \item Grift (seems to be the name of a compiler) \cite{Kuhlenschmidt2018}
    \item TypeScript on HiggsVM \cite{Richards2017}
    \item Reticulated Python \cite{Vitousek2017, Greenman2017}
\end{itemize}

\paragraph{Different types of type systems}

\sm{Also rather for related work, I think}

\begin{itemize}
    \item Nominal \cite{Muehlboeck2017}
    \item Structural \cite{Richards2017} (and Grace, \cite{Boyland2014})
    \item Tag (RPython) \cite{Greenman2017}
\end{itemize}

\paragraph{Other papers}

\sm{no idea what this is about}

\begin{itemize}
    \item \cite{Bloom2009}
    \item \cite{Castagna2017}
    \item \cite{Stulova2016}
\end{itemize}
